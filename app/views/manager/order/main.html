<?php

$this->useLayout(
	'manager/layout.html',
	array(
		'title' => 'Заказы',
		'user' => $this->user,
	)
);

?>

<div class="page-content">
	<div class="page-header">
		<h1>
			Список последних заказов
		</h1>
	</div>

	<div class="row">
		<div class="col-xs-12">
			<table class="table table-stripped table-bordered" id="orders-editable">
				<thead>
				<tr>
					<th title="Дата исполнения">
						<i class="ace-icon fa fa-clock-o bigger-110 hidden-480"></i>
						Дата
					</th>
					<th>Статус</th>
					<th>Заказ</th>
					<th>Время выполнения</th>
					<th>Контакты</th>
					<th>Дополнительно</th>
					<th>Адрес&nbsp;доставки</th>
					<th>Продажа</th>
					<th>Сборка</th>
					<th>Доставка</th>
					<th>ФЗП</th>
					<th></th>
				</tr>
				</thead>
				<tbody>
				<?php foreach ($this->orders as $order) { ?>
				<tr data-orderId="<?=$order['id'];?>">
					<td style="width:5px; white-space:nowrap;" class="delivery_date">
						<span class="value"><?=$order['delivery_date'];?></span>
						<br/><br/><button class="btn btn-minier btn-purple btn-add-order">Добавить</button>
					</td>
					<td style="width:10px;" class="status_id">
						<div class="order-text"><span class="label label-<?=Helper_Order::getLabelByStatus($order['status_id']);?>"><?=Table_Orders::me()->getStatusByStatusId($order['status_id']);?></span></div>
					</td>
					<td class="order">
						<div class="order-text">
							<?php $orderPositions = @unserialize($order['order']); ?>
							<?php if ($orderPositions) { ?>
								<table class="table table-striped table-hover dataTable order-table">
									<?php foreach ($orderPositions as $position) { ?>
										<tr>
											<td class="hardware"><?php echo $position['hardware']; ?></td>
											<td class="purchase-price"><?php echo $position['purchase-price']; ?></td>
											<td class="supplier"><?php echo $position['supplier']; ?></td>
										</tr>
									<?php } ?>
								</table>
							<?php } ?>
						</div>
						<div class="order-edit">
							<div class="order-position" style="height: 23px; width:465px;display: block;">
								<textarea name="order-hardware[]" class="order-hardware" placeholder="железка" style="width: 325px; height: 18px; resize: none;"></textarea>
								<input type="text" value="" name="order-purchase-price[]" class="input-small order-purchase-price" placeholder="закупка" style="width:40px;margin-left: 2px; margin-right: 2px;">
								<input type="text" value="" name="order-supplier[]" class="input-small order-supplier" placeholder="поставщик" style="width:50px;">
								<a class="green" href="#" style="margin-left: 3px;padding-top: 2px;" onclick="$(this).parents('.order-position').after($(this).parents('.order-position').clone()); return false;">
									<i class="ui-icon ace-icon fa fa-plus center bigger-100 blue"></i>
								</a>
								<a class="red" href="#" style="padding-top: 2px;" onclick="if ($(this).parents('td').find('.order-position').length > 1 ) {var td=$(this).parents('td'); $(this).parents('.order-position').remove(); recalculateTotalPurchase(td);} return false;">
									<i class="ace-icon fa fa-trash-o bigger-100"></i>
								</a>
							</div>
						</div>
					</td>
					<td class="delivery_time">
						<div class="order-text"><?=nl2br(Content_Text::escape($order['delivery_time']));?></div>
						<div class="order-edit"><textarea class="autosize" name="delivery_time" placeholder="Время исполнения"></textarea></div>
					</td>
					<td class="contacts">
						<div class="order-text"><?=nl2br(Content_Text::escape($order['contacts']));?></div>
						<div class="order-edit"><textarea class="autosize" name="contacts" placeholder="Контакты"></textarea></div></div>
					</td>
					<td class="notes">
						<div class="order-text"><?=nl2br(Content_Text::escape($order['notes']));?></div>
						<div class="order-edit"><textarea class="autosize" name="notes" placeholder="Другие заметки"></textarea></div>
					</td>
					<td class="delivery_address">
						<div class="order-text"><?=nl2br(Content_Text::escape($order['delivery_address']));?></div>
						<div class="order-edit"><textarea class="autosize" name="delivery_address" placeholder="Адрес доставки"></textarea></div>
					</td>
					<td class="sale_price" style="width:15px;">
						<div class="order-text"><?=(int)$order['sale_price'];?></div>
						<div class="order-edit"><input type="text" value="0" name="sale_price" class="input-mini spinner-input" style="width: 50px;"></div>
					</td>
					<td class="assembly_price" style="width:15px;">
						<div class="order-text"><?=(int)$order['assembly_price'];?></div>
						<div class="order-edit"><input type="text" value="0"  name="assembly_price" class="input-mini spinner-input" style="width: 50px;"></div>
					</td>
					<td class="delivery_price" style="width:15px;">
						<div class="order-text"><?=(int)$order['delivery_price'];?></div>
						<div class="order-edit"><input type="text" value="0" name="delivery_price" class="input-mini spinner-inputl" style="width: 50px;"></div>
					</td>
					<td>
						<div class="order-text"><?=Helper_Order::calculateFZP($order);?></div>
						<div class="order-edit"></div>
					</td>
					<td>
						<div class="hidden-sm hidden-xs action-buttons" style="width: 8px;">
							<div class="order-text">
								<a class="blue order-enable-edit" href="#">
									<i class="ace-icon fa fa-pencil bigger-130"></i>
								</a>
							</div>
							<div class="order-edit">
								<a class="green" href="#">
									<i class="ace-icon fa fa-check bigger-130"></i>
								</a>
							</div>
						</div>
					</td>
				</tr>
				<?php } ?>
				</tbody>
			</table>
			<div class="row"><div class="col-xs-6"><div class="dataTables_info" id="sample-table-2_info">Showing 1 to 10 of 23 entries</div></div><div class="col-xs-6"><div class="dataTables_paginate paging_bootstrap"><ul class="pagination"><li class="prev disabled"><a href="#"><i class="fa fa-angle-double-left"></i></a></li><li class="prev disabled"><a href="#"><i class="fa fa-angle-left"></i></a></li><li class="active"><a href="#">1</a></li><li><a href="#">2</a></li><li><a href="#">3</a></li><li class="next"><a href="#"><i class="fa fa-angle-right"></i></a></li><li class="next"><a href="#"><i class="fa fa-angle-double-right"></i></a></li></ul></div></div></div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		<?php foreach ($this->orders as $order) { ?>
			$('#spinner-assembly_price<?=$order['id'];?>').ace_spinner({value:<?=(int)$order['assembly_price'];?>,min:0,max:999,step:1, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
		.on('change', function(){
		});

		$('#spinner-delivery_price<?=$order['id'];?>').ace_spinner({value:<?=(int)$order['delivery_price'];?>,min:0,max:999,step:1, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
			.on('change', function(){
			});

	$('#spinner-sale_price<?=$order['id'];?>').ace_spinner({value:<?=(int)$order['sale_price'];?>,min:0,max:9999,step:1, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
	.on('change', function(){
	});

	<?php } ?>
	});
</script>